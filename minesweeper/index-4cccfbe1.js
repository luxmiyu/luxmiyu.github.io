var S=Object.defineProperty;var H=(n,e,t)=>e in n?S(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var r=(n,e,t)=>(H(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();const p=[{dark:"eaeaea",light:"2a2a2a",name:"text"},{dark:"bababa",light:"5a5a5a",name:"text-secondary"},{dark:"cd435c",light:"e86880",name:"selection"},{dark:"eaeaea",light:"2a2a2a",name:"selection-text"},{dark:"1a1a1a",light:"eaeaea",name:"background"},{dark:"222222",light:"dedede",name:"background-accent"},{dark:"3a3a3a",light:"d2d2d2",name:"shadow"},{dark:"8a8a8a",light:"8a8a8a",name:"hr"},{dark:"2a2a2a",light:"d8d8d8",name:"button"},{dark:"bababa",light:"5a5a5a",name:"button-border"},{dark:"3a3a3a",light:"eaeaea",name:"button-hover"},{dark:"5a5a5a",light:"fafafa",name:"button-active"},{dark:"8a8a8a",light:"fafafa",name:"button-disabled"},{dark:"2a2a2a",light:"d8d8d8",name:"input"},{dark:"5a5a5a",light:"8a8a8a",name:"input-border"},{dark:"eaeaea",light:"5a5a5a",name:"scrollbar-thumb"},{dark:"1a1a1a",light:"eaeaea",name:"scrollbar-track"},{dark:"bababa",light:"eaeaea",name:"range"},{dark:"3a3a3a",light:"aaaaaa",name:"range-border"},{dark:"3a3a3a",light:"aaaaaa",name:"range-background"},{dark:"e26f80",light:"f4899d",name:"checkbox-background"},{dark:"6dacff",light:"6dacff",name:"timer"},{dark:"eeb456",light:"efbf73",name:"algorithm"},{dark:"bababa",light:"bebebe",name:"cell"},{dark:"bababa",light:"bebebe",name:"mine"},{dark:"bababa",light:"bebebe",name:"flag"},{dark:"3a3a3a",light:"dddddd",name:"reveal"},{dark:"cd435c",light:"e86880",name:"explosion"},{dark:"3a3a3a",light:"dddddd",name:"wrong"},{dark:"5cd778",light:"5cd778",name:"right"},{dark:"75a6e5",light:"6dacff",name:"flagmode"},{dark:"6dacff",light:"0012f4",name:"one"},{dark:"44a159",light:"007c1b",name:"two"},{dark:"f7574a",light:"ff1e0e",name:"three"},{dark:"7765c2",light:"00057c",name:"four"},{dark:"aa5e5c",light:"850a05",name:"five"},{dark:"54aeac",light:"00807f",name:"six"},{dark:"707070",light:"000000",name:"seven"},{dark:"cacaca",light:"808080",name:"eight"}],b=document.getElementById("theme-toggle");b&&b.addEventListener("click",()=>{A()});document.addEventListener("keydown",n=>{n.altKey&&n.key==="l"&&A()});function A(){localStorage.setItem("theme",localStorage.getItem("theme")==="dark"?"light":"dark"),M()}let E="";function M(){let n=localStorage.getItem("theme")==="light"?"light":"dark";localStorage.setItem("theme",n),b&&(n==="dark"?b.innerHTML="switch to light theme ðŸŒž":b.innerHTML="switch to dark theme ðŸŒš");for(let e in p){let t=p[e].name,i=p[e][n];document.documentElement.style.setProperty(`--color-${t}`,`#${i}`)}E=n}M();setInterval(()=>{E!==localStorage.getItem("theme")&&M()},500);const C="&#128163;",$="&#128681;",F=document.getElementById("flagmode");function T(){return F.dataset.flagmode==="true"}class R{constructor(e,t,i,s){r(this,"x");r(this,"y");r(this,"mine");r(this,"revealed");r(this,"flagged");r(this,"count");r(this,"element");this.x=e,this.y=t,this.mine=!1,this.revealed=!1,this.flagged=!1,this.count=0,this.element=document.createElement("div"),this.element.classList.add("cell"),this.element.innerHTML="",this.element.addEventListener("click",()=>{T()?s(e,t):i(e,t)}),this.element.addEventListener("contextmenu",a=>{a.preventDefault(),T()?i(e,t):s(e,t)})}toString(){return`(${this.x}, ${this.y})`}setMine(){this.mine=!0}reveal(){if(!(this.revealed||this.flagged)){if(this.revealed=!0,this.element.classList.add("revealed"),this.mine)this.element.innerHTML=C,this.element.classList.add("mine");else if(this.count>0)switch(this.element.innerHTML=this.count.toString(),this.count){case 1:this.element.classList.add("one");break;case 2:this.element.classList.add("two");break;case 3:this.element.classList.add("three");break;case 4:this.element.classList.add("four");break;case 5:this.element.classList.add("five");break;case 6:this.element.classList.add("six");break;case 7:this.element.classList.add("seven");break;case 8:this.element.classList.add("eight");break}}}explode(){this.element.classList.add("explosion")}hide(){this.revealed&&(this.revealed=!1,this.element.classList.remove("revealed"),this.element.innerHTML="")}flag(){this.revealed||this.flagged||(this.flagged=!0,this.element.classList.add("flagged"),this.element.innerHTML=$)}unflag(){this.revealed||!this.flagged||(this.flagged=!1,this.element.classList.remove("flagged"),this.element.innerHTML="")}judge(){this.element.classList.remove("right","wrong"),this.flagged&&this.mine?this.element.classList.add("right"):this.flagged&&!this.mine&&this.element.classList.add("wrong")}}const w=document.getElementById("timer"),z=document.getElementById("flags"),v=document.getElementById("flagmode");function N(n,e,t,i){return Math.max(Math.abs(n-t),Math.abs(e-i))}function y(n){let e=n,t=Math.floor(e/1e3);e=e%1e3;let i=Math.floor(t/60);t=t%60;let s=Math.floor(i/60);return i=i%60,s>0?`${s}:${i.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}.${e.toString().padStart(3,"0")}`:`${i}:${t.toString().padStart(2,"0")}.${e.toString().padStart(3,"0")}`}async function x(n){return new Promise(e=>setTimeout(e,n))}class B{constructor(e,t){r(this,"difficulty");r(this,"cells");r(this,"element");r(this,"startTime");r(this,"endTime");r(this,"lastTime");r(this,"status");r(this,"breakAlgorithm");this.difficulty=t,this.cells=[],this.element=e,this.startTime=null,this.endTime=null,this.lastTime="",this.status="waiting",this.breakAlgorithm=!0,this.initialize(),setInterval(this.updateTimer.bind(this),10)}get difficultyName(){return this.difficulty.name}get size(){return this.difficulty.size}get totalMines(){return this.difficulty.mines}get clearDistance(){return this.difficulty.clear}initialize(e){e&&(this.difficulty=e),this.status="waiting",this.element.innerHTML="",this.element.style.gridTemplateColumns=`repeat(${this.size}, 1fr)`,this.element.style.gridTemplateRows=`repeat(${this.size}, 1fr)`,this.element.style.fontSize=`${36/this.size}cqb`,this.cells=[],this.startTime=null,this.endTime=null,this.breakAlgorithm=!0;for(let t=0;t<this.size;t++){this.cells[t]=[];for(let i=0;i<this.size;i++){const s=new R(i,t,this.onReveal.bind(this),this.onFlag.bind(this));this.cells[t][i]=s,this.element.appendChild(s.element)}}this.updateFlagDisplay()}updateTimer(){let e="";if(this.status==="ongoing"){const t=Date.now(),i=t-(this.startTime||t);e=y(i)}else this.status==="waiting"?e=y(0):e=y(this.endTime-this.startTime);e!==this.lastTime&&(this.lastTime=e,w.innerText=e)}updateTimerBackground(e){const t=(e*100).toFixed(2);w.style.background=`linear-gradient(90deg, var(--color-timer) ${t}%, var(--color-background) ${t}%)`}updateFlagDisplay(){const e=this.getAllFlags().length,t=this.totalMines,i=e/t;z.innerHTML=`${e} / ${t} flags`,this.updateTimerBackground(i)}getCell(e,t){return this.cells[t][e]}getAllCells(){return this.cells.flat()}getAllNeighbors(e,t){const i=[];for(let s=-1;s<=1;s++)for(let a=-1;a<=1;a++){if(a===0&&s===0)continue;const l=e+a,o=t+s;this.isOutOfBounds(l,o)||i.push(this.getCell(l,o))}return i}getAllUnrevealed(){return this.getAllCells().filter(e=>!e.revealed)}getAllMines(){return this.getAllCells().filter(e=>e.mine)}getAllFlags(){return this.getAllCells().filter(e=>e.flagged)}judgeAllFlags(){this.getAllFlags().forEach(e=>e.judge())}countNeighbors(e,t,i){let s=0;for(let a=-1;a<=1;a++)for(let l=-1;l<=1;l++){if(l===0&&a===0)continue;const o=e+l,h=t+a;this.isOutOfBounds(o,h)||i(this.getCell(o,h))&&s++}return s}isOutOfBounds(e,t){return e<0||t<0||e>=this.size||t>=this.size}updateCounts(){this.getAllCells().forEach(t=>{t.mine||(t.count=this.countNeighbors(t.x,t.y,i=>i.mine))})}generateMines(e,t){let i=this.totalMines;for(;i>0;){const s=Math.floor(Math.random()*this.size),a=Math.floor(Math.random()*this.size);N(e,t,s,a)<=this.clearDistance||this.getCell(s,a).mine||(this.getCell(s,a).setMine(),i--)}this.updateCounts()}checkWin(){const e=this.getAllUnrevealed(),i=this.getAllMines().every(a=>a.flagged),s=e.every(a=>a.mine);(i||s)&&this.win()}win(){this.status="won",this.getAllMines().forEach(e=>e.flag()),this.judgeAllFlags(),this.endTime=Date.now(),this.updateTimer(),v.classList.add("win"),v.innerText="CLEAR"}lose(e,t){this.status="lost",this.getAllMines().forEach(i=>i.reveal()),this.getCell(e,t).explode(),this.judgeAllFlags(),this.endTime=Date.now(),this.updateTimer(),v.classList.add("lose"),v.innerText="GAME OVER"}revealCenter(){const[e,t]=[Math.floor(this.size/2),Math.floor(this.size/2)];this.onReveal(e,t)}async algorithmStep(e=!1,t=!1){if(this.status==="waiting"){console.log("[ALGORITHM] starting move"),this.revealCenter();return}const s=this.getAllCells().filter(a=>{if(!a.revealed||a.count===0)return!1;const l=this.countNeighbors(a.x,a.y,m=>!m.revealed&&!m.flagged),o=this.countNeighbors(a.x,a.y,m=>m.flagged),h=this.countNeighbors(a.x,a.y,m=>!m.revealed),L=o===a.count&&l>0,I=h===a.count&&o<a.count;return L||I});if(s.length>0){console.log(`[ALGORITHM] trivial move, ${s.length} cells`);for(let a of s)this.onReveal(a.x,a.y)}else if(e||t){const a=this.getAllUnrevealed().filter(h=>!h.flagged),l=a.filter(h=>h.flagged||t&&h.mine?!1:this.countNeighbors(h.x,h.y,L=>L.revealed)>=1);console.log(`[ALGORITHM] ${t?"cheating":"guessing"} move, ${a.length} cells remaining, ${l.length} cells filtered`);const o=l[Math.floor(Math.random()*l.length)]??a[Math.floor(Math.random()*a.length)];this.onReveal(o.x,o.y)}else this.breakAlgorithm=!0}async algorithmSolve(e=!1,t=!1){if(console.log(`[ALGORITHM] guess: ${e}, cheat: ${t}`),this.status==="won"||this.status==="lost"){console.log("[ALGORITHM] game already over");return}for(this.breakAlgorithm=!1;this.status==="waiting"||this.status==="ongoing";){if(this.breakAlgorithm){console.log("[ALGORITHM] breaking algorithm loop");break}await this.algorithmStep(e,t),await x(10)}const i=this.status;i==="won"&&console.log("[ALGORITHM] game won"),i==="lost"&&console.log("[ALGORITHM] game lost"),i==="waiting"&&console.log("[ALGORITHM] game waiting"),i==="ongoing"&&console.log("[ALGORITHM] game ongoing")}onReveal(e,t){if(this.status==="waiting"&&(this.status="ongoing",this.generateMines(e,t),this.startTime=Date.now()),this.status!=="ongoing")return;const i=this.getCell(e,t);if(i.revealed){const s=this.countNeighbors(e,t,l=>l.flagged),a=this.countNeighbors(e,t,l=>!l.revealed);s===i.count&&this.getAllNeighbors(e,t).forEach(o=>{!o.revealed&&!o.flagged&&this.onReveal(o.x,o.y)}),a===i.count&&this.getAllNeighbors(e,t).forEach(o=>{!o.flagged&&this.getAllFlags().length<this.totalMines&&o.flag()})}else if(!i.flagged){if(i.mine){this.lose(e,t);return}i.reveal(),i.count===0&&this.getAllNeighbors(e,t).forEach(a=>{a.revealed||this.onReveal(a.x,a.y)})}this.checkWin(),this.updateFlagDisplay()}onFlag(e,t){if(this.status==="waiting"){this.onReveal(e,t);return}if(this.status!=="ongoing"||this.isOutOfBounds(e,t)||this.getAllFlags().length>=this.totalMines&&!this.getCell(e,t).flagged)return;const i=this.getCell(e,t);if(i.revealed){this.onReveal(e,t);return}i.flagged?i.unflag():i.flag(),this.checkWin(),this.updateFlagDisplay()}}function G(n){return n.charAt(0).toUpperCase()+n.slice(1)}class f{constructor(e,t,i,s){r(this,"name");r(this,"size");r(this,"mines");r(this,"clear");this.name=e,this.size=t,this.mines=i,this.clear=s}get density(){return this.mines/this.size**2}get densityPercentage(){return`${(this.density*100).toFixed(2)}%`}toString(){return`${G(this.name)} (${this.mines} mines)`}}const d=document.getElementById("flagmode"),k=document.getElementById("difficulty"),D=document.getElementById("reset"),U=document.getElementById("board"),u=[new f("easy",9,10,1),new f("normal",11,20,1),new f("hard",15,40,2),new f("insane",23,100,2),new f("expert",33,210,2),new f("master",45,420,3),new f("extreme",59,727,3),new f("suicide",99,2048,3)];u.forEach(n=>{let e=document.createElement("option");e.value=n.name,e.innerHTML=n.toString(),k.appendChild(e)});const g=new B(U,u[0]);function O(){g.initialize(),c(),c()}function K(){d.classList.remove("win","lose"),d.innerHTML="FLAG MODE ON",d.classList.add("on"),d.dataset.flagmode="true"}function P(){d.classList.remove("win","lose"),d.innerHTML="FLAG MODE OFF",d.classList.remove("on"),d.dataset.flagmode="false"}function c(){g.status==="won"||g.status==="lost"||(d.dataset.flagmode==="true"?P():K())}k.addEventListener("change",()=>{const n=u.find(e=>e.name===k.value);n&&(g.initialize(n),c(),c())});d.addEventListener("click",c);D.addEventListener("click",O);document.addEventListener("keydown",async n=>{if(n.code==="KeyF"&&c(),n.code==="KeyR"&&(O(),n.shiftKey&&g.revealCenter()),n.code.startsWith("Digit")&&n.code.length===6){const e=parseInt(n.code[5])-1;e>=0&&e<u.length&&(k.value=u[e].name,g.initialize(u[e]),c(),c())}if(n.code==="KeyC"&&g.revealCenter(),n.code==="KeyA"&&(g.status==="waiting"||g.status==="ongoing")){d.innerHTML="ALGORITHM",d.classList.add("algorithm");const e=n.shiftKey,t=n.altKey;e&&(d.innerHTML="ALGORITHM (GUESSING)"),t&&(d.innerHTML="ALGORITHM (CHEATING)"),console.log("starting algorithm..."),await g.algorithmSolve(e,t),d.classList.remove("algorithm"),c(),c()}});
